<html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="element-table.js" type="module"></script>
    <script src="element-grid.js" type="module"></script>
    <script src="element-contextmenu.js" type="module"></script>
    <script src="widget-image.js" type="module"></script>
    <script src="widget-code.js" type="module"></script>
    <script src="widget-text.js" type="module"></script>
    <script src="widget-download.js" type="module"></script>
    <script src="widget-sheetkey.js" type="module"></script>
    <script src="widget-hashimg.js" type="module"></script>
    <script src="widget-multi.js" type="module"></script>
    <script src="widget-testresult.js" type="module"></script>
</head>

<body>
    <ul id="sheetlist"></ul>
    <element-grid id="spreadsheet"></element-grid>

    <script>
        const params = new URL(document.URL).searchParams;
        const headers = {};
        if (localStorage.hasOwnProperty("jwt_token")) {
            headers["Authorization"] = `Bearer ${localStorage["jwt_token"]}`;
        }
        if (params.has("sheet")) {
            const data = fetch(`/sheets/${params.get("sheet")}`, { headers: headers }).then(response => {
                return response.json()
            }).then(data => {
                document.getElementById('spreadsheet').setAttribute('data', JSON.stringify({data: data.rows, columns: data.columns}));
            });
        } else {
            const data = fetch(`/sheets`, { headers: headers }).then(response => {
                return response.json()
            }).then(data => {
                data.forEach(sheetName => {
                    const elem = document.createElement("a");
                    elem.innerText = sheetName;
                    elem.setAttribute("href", `/sheet.html?sheet=${sheetName}`);
                    const li = document.createElement("li");
                    li.appendChild(elem);
                    document.getElementById('sheetlist').appendChild(li);
                });
            });
        }

    </script>
</body>

</html>